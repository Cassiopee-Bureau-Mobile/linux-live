# Linux Live Kit

Use this set of scripts to turn your existing preinstalled Linux
distribution into a Live Kit (formely known as Live CD) on an USB stick.
Make sure to extract and use it on a posix-compatible filesystem,
since it creates some (sym)links and such.

<h1>How to create a Live Linux</h1>

<h2>The build</h2>

- First of all **set up your Custom Linux**. To do so, I use a VM on Virtual Box to set up all the files and software you want to have on your linux.

- Once you have your custom linux set up, you need to **create a Live Kit** from it. To do so, you need to download the Linux Live Kit from this repo. You may not want to include the repo in your futur Live linux, so I recommend you to put it in a directory such as /a. _(Be warned, if you put it to /tmp, some distros may erase it on reboot.)_

- Before you start building your Kit, edit the file ./config. Most importantly change the LIVEKITNAME variable.

- Make sure your kernel is in /vmlinuz or change the path in ./config. Your kernel must support squashfs. Your kernel must also support either aufs or overlayfs or both. AUFS is recommended for more flexibility, but if your distro does not support it, overlayfs will work too.

- You may also wish to replace boot graphics in ./bootfiles/bootlogo.png (one options is to modify and run the ./tools/bootlogo.update script) and reorganize isolinux.cfg to fit your needs (when editing the file, keep all paths in /boot/, it will be rellocated during LiveKit creation)

- Linux Live Kit comes with precompiled static binaries in ./initramfs directory. Those may be outdated but will work. You may replace them by your own statically linked binaries, if you know how to compile them.

- If you have tmpfs mounted on /tmp during building your Live Kit ISO,
  make sure you have enough RAM since LiveKit will store lots of data in /tmp.
  If you are low on RAM, make sure /tmp is a regular on-disk directory.

- When done, run the ./build script to create your Live Kit
  - it will create sh files to generate ISO and TAR from the data builed in /tmp
  - make sure you have enough free space in /tmp to handle it

<h2>Set up Your USB stick</h2>

- To be able to boot from USB, you need to have a bootable USB stick. To do so, the first step it to create two partitions on your USB stick. The first one will be a FAT32 partition for the EFI boot, and the second one will be a Linux partition (Ext4). _You can use GParted to do so. You can also use the following command to create the partitions:_

      sudo parted /dev/sdX mklabel msdos
      sudo parted /dev/sdX mkpart primary fat32 0% 100M
      sudo parted /dev/sdX mkpart primary ext4 100M 100%

- Now plug the USB and copy/past the folder in data folder generated by the build script in /tmp to the root of your USB stick in the Ext4 partition.

- Now go to this folder **on your USB device !**. And run the bootinst.sh script in the bootfiles folder. This will generate the EFI folder in **the root** of your USB stick. Copy it in the Fat32 partition of the USB.

- Change the contents of /linux/boot/syslinux.cfg file to:

      UI /linux/boot/vesamenu.c32

      TIMEOUT 140
      MENU ROWS 4

      MENU CLEAR
      MENU BACKGROUND /linux/boot/bootlogo.png

      LABEL default1
      MENU LABEL Run Linux
      KERNEL /linux/boot/vmlinuz
      APPEND vga=769 initrd=/linux/boot/initrfs.img load_ramdisk=1 prompt_ramdisk=0 rw printk.time=0 apparmor=0

      LABEL default2
      MENU LABEL Run Linux debug
      KERNEL /linux/boot/vmlinuz
      APPEND vga=769 initrd=/linux/boot/initrfs.img load_ramdisk=1 prompt_ramdisk=0 rw printk.time=0 apparmor=0 debug

      LABEL default3
      MENU LABEL Run Linux (Persistent changes)
      KERNEL /linux/boot/vmlinuz
      APPEND vga=769 initrd=/linux/boot/initrfs.img load_ramdisk=1 prompt_ramdisk=0 rw printk.time=0 apparmor=0 perch,automount

      LABEL perch
      MENU LABEL Run Linux (Fresh start)
      KERNEL /linux/boot/vmlinuz
      APPEND vga=769 initrd=/linux/boot/initrfs.img load_ramdisk=1 prompt_ramdisk=0 rw printk.time=0 apparmor=0 automount

      LABEL toram
      MENU LABEL Run Linux (Copy to RAM)
      KERNEL /linux/boot/vmlinuz
      APPEND vga=769 initrd=/linux/boot/initrfs.img load_ramdisk=1 prompt_ramdisk=0 rw printk.time=0 apparmor=0 toram

  **make sure to change the _linux_ name by your LIVEKITNAME**

- Copy the bootlogo.png, initrfs.img, vmlinuz files from the /linux/boot folder of first Ext4 partition to the /EFI/boot/ folder of the second Fat32 partition

- Finally change the contents of /EFI/boot/syslinux.cfg to:

      UI vesamenu.c32

      TIMEOUT 140
      MENU ROWS 4

      MENU CLEAR
      MENU BACKGROUND bootlogo.png

      LABEL default1
      MENU LABEL Run Linux
      KERNEL vmlinuz
      APPEND vga=769 initrd=initrfs.img load_ramdisk=1 prompt_ramdisk=0 rw printk.time=0 apparmor=0

      LABEL default2
      MENU LABEL Run Linux debug
      KERNEL vmlinuz
      APPEND vga=769 initrd=initrfs.img load_ramdisk=1 prompt_ramdisk=0 rw printk.time=0 apparmor=0 debug

      LABEL default3
      MENU LABEL Run Linux (Persistent changes)
      KERNEL vmlinuz
      APPEND vga=769 initrd=initrfs.img load_ramdisk=1 prompt_ramdisk=0 rw printk.time=0 apparmor=0 perch,automount

      LABEL perch
      MENU LABEL Run Linux (Fresh start)
      KERNEL vmlinuz
      APPEND vga=769 initrd=initrfs.img load_ramdisk=1 prompt_ramdisk=0 rw printk.time=0 apparmor=0 automount

      LABEL toram
      MENU LABEL Run Linux (Copy to RAM)
      KERNEL vmlinuz
      APPEND vga=769 initrd=initrfs.img load_ramdisk=1 prompt_ramdisk=0 rw printk.time=0 apparmor=0 toram

<h4>You can now start on your USB stick</h4>

Notes:

- In the syslinux boot interface, if you execute the classic Linux, you will have the exact linux you've build. You can have persistent changes using the right option, but this will never change the original Live linux you've build. _So be aware that your persistent changes will only be available with the Persistent changes mode in the boot interface._

This project was forked from Tomas M. <http://www.linux-live.org> and modified by Cl√©ment Safon
